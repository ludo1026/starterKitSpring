## Macro
## Champs de la clé primaire qui ne sont pas dans les liens
#macro( isFieldUsedInLinks, $field, $links )
#set( $isFieldUsedInLinks = false )
#foreach( $link in $links )
#if( !$link.isCardinalityManyToMany() && !$link.isCardinalityOneToMany() )
#foreach( $joinColumn in $link.joinColumns )
#if( $joinColumn == $field.databaseName )
#set( $isFieldUsedInLinks = true )
#end
#end
#end
#end
#end
## Liens utilisant les champs
#macro( isLinkUsedByFields, $link, $fields)
#set( $isLinkUsedByFields = false )
#if( !$link.isCardinalityManyToMany() && !$link.isCardinalityOneToMany() )
#foreach( $field in $fields )
#foreach( $joinColumn in $link.joinColumns )
#if( $joinColumn == $field.databaseName )
#set( $isLinkUsedByFields = true )
#end
#end
#end
#end
#end
## Informations sur la clé primaire d'une entité
#macro( defineKeyInfoForEntity, $entity )
#if ( $entity.hasCompositePrimaryKey() )
#set( $keyType = "${entity.name}Id" )
#set( $keyName = "id" )
#set( $keySetter = "setId" )
#set( $keyGetter = "getId" )
#else
#foreach( $field in $entity.keyAttributes )
#set( $keyType = "$field.wrapperType" )
#set( $keyName = "$field.formatedName(0)" )
#set( $keyField = $field )
#set( $keySetter = $field.setter )
#set( $keyGetter = $field.getter )
#end
#end
#end
##--------------------------------------------------------------------------------------------------------
## Data fields = fields not in Primary Key
#set( $dataFields = $entity.getAttributesByCriteria( $const.NOT_KEY ) )
## Key fields = fields in Primary Key
#set( $keyFields = $entity.getAttributesByCriteria( $const.KEY ) )
##--------------------------------------------------------------------------------------------------------
## IF COMPOSITE PRIMARY KEY : GENERATE A JAVA CLASS FOR THIS COMPOSITE KEY
#if ( $entity.hasCompositePrimaryKey() )
$generator.generate($target.entityName ,  "${entity.name}Id.java", $target.folder, "entity/entity_pk.vm"  )
#end
##--- @Transient usage count ( number of xxxToMany links ) 
#set ( $TRANSIENT_COUNT = 0 )
#foreach( $link in $entity.selectedLinks )
#if ( $link.isCardinalityManyToMany() || $link.isCardinalityOneToMany() )
#set ( $TRANSIENT_COUNT = $TRANSIENT_COUNT + 1 )
#end
#end
package ${target.javaPackageFromFolder($SRC)};

import java.io.Serializable;

import javax.validation.constraints.* ;
//import org.hibernate.validator.constraints.* ;

#foreach( $import in $entity.imports )
import $import;
#end
## Clé primaire
#if ( $beanClass.hasCompositePrimaryKey() )
import ${ENTITY_PKG}.${beanClass.name}Id;
#set( $keyType = "${beanClass.name}Id" )
#set( $keyName = "id" )
#set( $keySetter = "setId" )
#set( $keyGetter = "getId" )
#else
#foreach( $field in $entity.keyAttributes )
#set( $keyType = "$field.wrapperType" )
#set( $keyName = "$field.formatedName(0)" )
#set( $keyField = $field )
#set( $keySetter = $field.setter )
#set( $keyGetter = $field.getter )
#end
#end

#foreach( $import in $entity.importsJpa )
import $import;
#end
import javax.validation.Valid;
import javax.xml.bind.annotation.XmlAccessType;
import javax.xml.bind.annotation.XmlAccessorType;
import javax.xml.bind.annotation.XmlRootElement;
#if (  $TRANSIENT_COUNT > 0 ) 
import javax.xml.bind.annotation.XmlTransient;
#end

/**
 * Persistent class for entity stored in table "${entity.databaseTable}"
 */
@XmlRootElement  // JAXB annotation for REST Web Services
@XmlAccessorType(XmlAccessType.PROPERTY) // JAXB accessor = getter/setter pair
$entity.jpaAnnotations
// Define named queries here
// @NamedQueries ( {
//  @NamedQuery ( name="${entity.name}.query1", query="SELECT x FROM ${entity.name} x WHERE  " ),
//  @NamedQuery ( name="${entity.name}.query2", query="SELECT x FROM ${entity.name} x WHERE  " )
// } )
public class $entity.name implements Serializable
{
    private static final long serialVersionUID = 1L;

#if ( $entity.hasCompositePrimaryKey() )
	@EmbeddedId
	@Valid
    private $keyType $keyName = new $keyType();

#else 
$keyField.jpaAnnotations(4)
$keyField.beanValidationAnnotationsJSR303(4)
    private $keyType $keyName#if($keyField.hasInitialValue()) = ${keyField.initialValue}#end;

#end
## FIELDS 
#foreach( $field in $dataFields )
#isFieldUsedInLinks( $field, $entity.selectedLinks )
#if( ! $isFieldUsedInLinks )
$field.jpaAnnotations(4)
$field.beanValidationAnnotationsJSR303(4)
    private $field.wrapperType $field.formatedName(0) #if($field.hasInitialValue())= ${field.initialValue} #end;

#end
#end
##-- ENTITY LINKS ( RELATIONSHIP )
#foreach( $link in $entity.selectedLinks )
#isLinkUsedByFields( $link, $dataFields )
#if( $isLinkUsedByFields )
$link.jpaAnnotations(4)
    private $link.formatedType(0) $link.formatedName(0);

#end
#end    
## PRIMARY KEY
	public ${keyType} ${keyGetter}() {
        return ${keyName};
    }
 
    public void ${keySetter}(${keyType} ${keyName}) {
        this.${keyName} = ${keyName};
    }

## FIELDS
#foreach( $field in $dataFields )
#isFieldUsedInLinks( $field, $entity.selectedLinks )
#if( ! $isFieldUsedInLinks )
#if ( $field.setter )    public void ${field.setter}( $field.wrapperType $field.name )
    {
        this.$field.name = $field.name;
    }

#end
#if ( $field.getter )    public $field.wrapperType ${field.getter}()
    {
        return this.$field.name;
    }

#end
#end  
#end  
## LINKS
#foreach( $link in $entity.selectedLinks )
#isLinkUsedByFields( $link, $dataFields )
#if( $isLinkUsedByFields )
#if ( $link.isCardinalityManyToMany() || $link.isCardinalityOneToMany() ) 
    @XmlTransient
#end
#if ( $link.setter )    public void ${link.setter}( ${link.linkType} ${link.javaName} )
    {
        this.${link.javaName} = ${link.javaName};
    }

#end
#if ( $link.getter )    public ${link.linkType} ${link.getter}()
    {
        return this.${link.javaName};
    }

#end
#end
#end  
## COMPOSITE KEY
#if( $entity.hasCompositePrimaryKey() )
## COMPOSITE KEY FIELDS
#foreach( $field in $keyFields )
#isFieldUsedInLinks( $field, $entity.selectedLinks )
#if( ! $isFieldUsedInLinks )
#if ( $field.setter )    public void ${field.setter}( $field.wrapperType $field.name )
    {
        this.${keyName}.${field.setter}($field.name);
    }

#end
#if ( $field.getter )    public $field.wrapperType ${field.getter}()
    {
        return this.${keyName}.${field.getter}();
    }

#end
#end  
#end
## COMPOSITE KEY LINKS
#foreach( $link in $entity.selectedLinks )
#isLinkUsedByFields( $link, $keyFields )
#if( $isLinkUsedByFields )
#if ( $link.isCardinalityManyToMany() || $link.isCardinalityOneToMany() ) 
    @XmlTransient
#end
#if ( $link.setter )    public void ${link.setter}( ${link.linkType} ${link.javaName} )
    {
        this.${keyName}.${link.setter}(${link.javaName});
    }

#end
#if ( $link.getter )    public ${link.linkType} ${link.getter}()
    {
        return this.${keyName}.${link.getter}();
    }

#end
#end
#end  
## FIN COMPOSITE KEY  
#end
    public String toString()
    {
#set( $attributes = $entity.getAttributesByCriteria( $const.NOT_KEY, $const.NOT_IN_SELECTED_LINKS ) )    
$entity.toStringMethodCodeLinesWithKey(8, $attributes, $keyName) 
## The "key" is used only if composite key
#foreach( $field in $entity.getAttributesByCriteria( $const.TEXT ) )
		// $field.name is not in toString because it's a "long text" field
#end  
    }

}
