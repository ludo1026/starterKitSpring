/*
 * Controller class 
 * Created on $today.date ( Time $today.time )
 */

package ${target.javaPackageFromFolder(${SRC})};

import java.util.List;

import org.springframework.beans.propertyeditors.CustomNumberEditor;
import org.springframework.stereotype.Controller;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.WebDataBinder;
import org.springframework.web.bind.annotation.InitBinder;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.servlet.ModelAndView;

import ${ENTITY_PKG}.${beanClass.name};
import ${SERVICE_PKG}.${beanClass.name}Service;

#if ( $beanClass.hasCompositePrimaryKey() )
import org.demo.${beanClass.name.toLowerCase()}.bean.${beanClass.name}Key;
#set( $keyType = "${beanClass.name}Key" )
#set( $keyName = "id" )
#else
#foreach( $field in $entity.keyAttributes )
#set( $keyType = "$field.formatedType(0)" )
#set( $keyName = "$field.formatedName(0)" )
#end
#end

@Controller
@RequestMapping("/${beanClass.name.toLowerCase()}form")
public class ${beanClass.name}FormController 
{
    private ${beanClass.name}Service ${beanClass.name.toLowerCase()}Service;

	@InitBinder
	protected void initBinder(WebDataBinder binder) {
	    binder.registerCustomEditor(Integer.class, new CustomNumberEditor(Integer.class, true));
	}

	@RequestMapping(value = "/save", method = RequestMethod.POST)
	public String save(@ModelAttribute("${beanClass.name.toLowerCase()}") ${beanClass.name} ${beanClass.name.toLowerCase()}, BindingResult result) {
		${beanClass.name.toLowerCase()}Service = new ${beanClass.name}Service();
		if (!result.hasErrors()) {
			${beanClass.name.toLowerCase()}Service.save(${beanClass.name.toLowerCase()});
		}else{
			System.out.println(result.getAllErrors().get(0).getDefaultMessage());
		}
		return "redirect:/${beanClass.name.toLowerCase()}/list";
	}

	@RequestMapping(value = "/delete/{$keyName}")
	public String delete(@ModelAttribute("${beanClass.name.toLowerCase()}/delete") ${beanClass.name} ${beanClass.name.toLowerCase()}, @PathVariable("$keyName") $keyType $keyName) {
		${beanClass.name.toLowerCase()}Service = new ${beanClass.name}Service();
		if ($keyName != null){
			${beanClass.name.toLowerCase()}Service.delete($keyName);
		}
		return "redirect:/${beanClass.name.toLowerCase()}/list";
	}
	
	@RequestMapping(value = "/search")
	public ModelAndView search(@ModelAttribute("${beanClass.name.toLowerCase()}form") ${beanClass.name} ${beanClass.name.toLowerCase()}, BindingResult result) {
		${beanClass.name.toLowerCase()}Service = new ${beanClass.name}Service();
		ModelAndView mav = new ModelAndView("${beanClass.name.toLowerCase()}/${beanClass.name.toLowerCase()}List");
		List<${beanClass.name}> list = ${beanClass.name.toLowerCase()}Service.search(${beanClass.name.toLowerCase()});
		mav.addObject("list${beanClass.name.toLowerCase()}s", list);
		return mav;
	}
	
	@RequestMapping("/clear")
	public ModelAndView clear() {
		return new ModelAndView("${beanClass.name.toLowerCase()}/${beanClass.name.toLowerCase()}", "command", new ${beanClass.name}());
	}
}
